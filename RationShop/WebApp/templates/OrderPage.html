<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RationKart - Orders</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{% static 'web/assets/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'web/assets/css/style.css' %}">
    <link rel="stylesheet" href="{% static 'web/assets/css/responsive.css' %}">
    <link rel="icon" href="{% static 'web/assets/images/Ration.png' %}" type="image/gif"/>
    <link rel="stylesheet" href="{% static 'web/assets/css/jquery.mCustomScrollbar.min.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        /* Styles from your original template (if you have any custom styles, keep them) */
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        .order-card { /* ... your existing order-card styles ... */
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            background-color: white;
            margin-bottom: 20px;
        }

        .order-header { /* ... your existing order-header styles ... */
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .delivered-badge { /* ... your existing delivered-badge styles ... */
            background-color: #e8f5e9;
            color: #2e7d32;
            border-radius: 20px;
            padding: 8px 16px;
            display: inline-flex;
            align-items: center;
            font-weight: 500;
        }

        .delivered-badge i { /* ... your existing delivered-badge styles ... */
            margin-right: 6px;
        }

        .table th { /* ... your existing table th styles ... */
            color: #6c757d;
            font-weight: 500;
        }

        .total-section { /* ... your existing total-section styles ... */
            text-align: right;
        }

        .timeline { /* ... your existing timeline styles ... */
            position: relative;
            padding-left: 30px;
        }

        .timeline-item { /* ... your existing timeline-item styles ... */
            position: relative;
            padding-bottom: 30px;
        }

        .timeline-item:last-child { /* ... your existing timeline-item styles ... */
            padding-bottom: 0;
        }

        .timeline-icon { /* ... your existing timeline-icon styles ... */
            position: absolute;
            left: -30px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #e0e0e0;
        }

        .timeline-icon i { /* ... your existing timeline-icon styles ... */
            color: #424242;
        }

        .timeline-line { /* ... your existing timeline-line styles ... */
            position: absolute;
            left: -11px;
            top: 40px;
            bottom: 0;
            width: 2px;
            background-color: #e0e0e0;
        }

        .timeline-content { /* ... your existing timeline-content styles ... */
            padding-left: 15px;
        }

        .timeline-date { /* ... your existing timeline-date styles ... */
            color: #6c757d;
            font-size: 0.9rem;
        }

        .timeline-title { /* ... your existing timeline-title styles ... */
            font-weight: 600;
            margin: 3px 0;
        }

        .timeline-desc { /* ... your existing timeline-desc styles ... */
            color: #6c757d;
            font-size: 0.9rem;
        }

        .back-link { /* ... your existing back-link styles ... */
            color: #212529;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .back-link i { /* ... your existing back-link styles ... */
            margin-right: 6px;
        }
    </style>
</head>
<body class="main-layout inner_page">

<header>
    <div class="header">
        <div class="container">
            <div class="row">
                <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col logo_section">
                    <div class="full">
                        <div class="center-desk">
                            <div class="logo">
                                <a href="{% url 'Home' %}"><img src="{% static 'web/assets/images/Rationlogo.png' %}"
                                                                style="width:300px;height:100px;" alt="#"/></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-9 col-lg-10 col-md-12 col-sm-9">
                    <nav class="navigation navbar navbar-expand-md navbar-dark ">
                        <button class="navbar-toggler" type="button" data-toggle="collapse"
                                data-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false"
                                aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarsExample04">
                            <ul class="navbar-nav mr-auto">
                                <li class="nav-item">
                                    {% if request.session.Ration_Card %}
                                    <a class="nav-link" href="{% url 'Home' %}"> Home </a>
                                    {% elif request.session.Reg_Num %}
                                    <a class="nav-link" href="{% url 'ShopHome' %}"> Home </a>
                                    {% endif %}
                                </li>
                                {% if request.session.Reg_Num %}
                                <li class="nav-item">
                                    <a class="nav-link" href="{% url 'Requests' %}"> Orders </a>
                                </li>
                                {% endif %}
                                <li class="nav-item ">
                                    {% if request.session.Ration_Card %}
                                    <a class="nav-link" href="{% url 'Products' %}"> Ration </a>
                                    {% elif request.session.Reg_Num %}
                                    <a class="nav-link" href="{% url 'ShopStock' %}"> Stock </a>
                                    {% endif %}
                                </li>

                                <li class="nav-item">
                                    <a class="nav-link" href="{% url 'CartPage' %}" style="position:relative;">Cart
                                        <span class="position-absolute bg-secondary rounded-circle d-flex align-items-center justify-content-center text-dark px-1"
                                              style="top: -12px; left: 55px; height: 20px; min-width: 20px;">{{ x }}</span></a>
                                </li>
                                <li class="nav-item active">
                                    {% if request.session.Ration_Card %}
                                    <a class="nav-link" href="{% url 'OrderPage' %}"> Orders </a>
                                    {% elif request.session.Reg_Num %}
                                    <a class="nav-link" href="{% url 'OrderPage' %}"> Request </a>
                                    {% endif %}
                                </li>

                                <li class="nav-item">
                                    <a class="nav-link" href="{% url 'About' %}">About</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="{% url 'ContactUs' %}">Contact Us</a>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" role="button"
                                       data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="bi bi-person-circle" style="font-size: 2rem;"></i>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
                                        {% if request.session.Ration_Card %}
                                        <h2 style="text-align:center;">Hi, {{ request.session.Ration_Card }}</h2>
                                        <hr style="border: 2px solid black; margin: 20px 0;">
                                        {% if details and details.id %}
                                        <button class="dropdown-item">
                                            <a href="{% url 'MyDetails' details.id %}">My Details</a>
                                        </button>
                                        {% else %}
                                        <p style="text-align: center;">Details not available</p>
                                        {% endif %}
                                        <hr style="border: 2px solid black; margin: 20px 0;">
                                        <a class="dropdown-item" href="{% url 'LogOut' %}">Logout</a>
                                        {% elif request.session.Reg_Num %}
                                        <h2 style="text-align:center;">Hi, {{ request.session.Reg_Num }}</h2>
                                        <hr style="border: 2px solid black; margin: 20px 0;">
                                        {% if shp and shp.id %}
                                        <button class="dropdown-item">
                                            <a href="{% url 'MyDetails' shp.id %}">My Details</a>
                                        </button>
                                        <button class="dropdown-item">
                                            <a href="{% url 'PartnerDetails'%}">View Partner Details</a>
                                        </button>
                                        {% else %}
                                        <p style="text-align: center;">Details not available</p>
                                        {% endif %}
                                        <hr style="border: 2px solid black; margin: 20px 0;">
                                        <a class="dropdown-item" href="{% url 'LogOut' %}">Logout</a>
                                        {% else %}
                                        <a class="dropdown-item" href="{% url 'LoginPage' %}">Login</a>
                                        {% endif %}
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</header>

<div class="container my-4">
    {% if request.session.Ration_Card %}
    <a href="{% url 'Home' %}" class="back-link mb-4">
        <i class="bi bi-arrow-left"></i> Back to Home
    </a>
    {% elif request.session.Reg_Num %}
    <a href="{% url 'ShopHome' %}" class="back-link mb-4">
        <i class="bi bi-arrow-left"></i> Back to Home
    </a>
    {% else %}
    <a></a>
    {% endif %}

    {% for order in orders %}
    <div class="order-card p-4 mb-4">
        <div class="order-header">
            <div>
                <h3 class="mb-0">Order Number: {{ order.Order_Num }}</h3>
                <p class="text-muted">Placed on {{ order.created_at|date:"Y-m-d" }}</p>
            </div>
            <div class="delivered-badge">
                <i class="bi bi-clock-fill"></i> {% if order.status %}
                {{ order.status.get_status_display }} {% else %} Pending {% endif %}
            </div>
        </div>

        <div class="row g-3 mb-3">
            <div class="col-md-4">
                <div class="p-3 border rounded">
                    <h5 class="mb-2">Customer Information</h5>
                    <p class="mb-1 fw-bold">Name : {{ order.Name }}</p>
                    <p class="mb-1">Email : {{ order.Email }}</p>
                    <p class="mb-0">Mobile : {{ order.Mobile }}</p>
                    <p class="mb-0">Shop ID : {{ order.Shop }}</p>

                </div>
            </div>


        </div>

        <h4 class="mb-3">Order Items</h4>
        <div class="table-responsive">
            <table class="table">
                <thead>
                <tr>
                    <th style="width: 50%">Item</th>

                    {% if request.session.Ration_Card %}
                    <th class="text-center">Quantity</th>
                    <th class="text-end">Price</th>
                    <th class="text-end">Total</th>
                    {% elif request.session.Reg_Num %}
                    <th class="text-center">Quantity</th>
                    {% endif %}

                </tr>
                </thead>
                <tbody>
                {% for cart_item in order.cart_items.all %} {# Iterate through cart items for EACH order #}
                <tr>
                    <td>{{ cart_item.Item_Name }}</td>
                    {% if request.session.Ration_Card %}
                    <td class="text-center">{{ cart_item.Item_Quantity }} Kg</td>
                    <td class="text-end">₹{{ cart_item.I_Price }}</td>
                    <td class="text-end">₹{{ cart_item.I_Total }}</td>
                    {% elif request.session.Reg_Num %}
                    <td class="text-center">{{ cart_item.Item_Quantity }} Kg</td>
                    {% endif %}

                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        {% if request.session.Ration_Card %}
        <div class="row mt-3">
            <div class="col-md-6"></div>
            <div class="col-md-6">
                <div class="total-section">
                    <div class="d-flex justify-content-between fw-bold mt-2 pt-2 border-top">
                        <span>Order Total:</span>
                        <span>₹{{ order.total }}</span> {# Display Order Total using order.total property #}
                    </div>
                </div>
            </div>
        </div>
        {% elif request.session.Reg_Num %}
        <div></div>
        {% endif %}

        <div class="order-card p-4 mt-4">
            <h4 class="mb-4">Order Timeline</h4>
            <div class="timeline">
                {% if order.status %} {# Check if order.status exists #}
                <div class="timeline-item">
                    <div class="timeline-icon">
                        {# Dynamically choose icon based on status #}
                        {% if order.status.status == 'pending' %}
                        <i class="bi bi-hourglass-split"></i> {# Pending icon #}
                        {% elif order.status.status == 'accepted' %}
                        <i class="bi bi-gear"></i> {# Processing icon #}
                        {% elif order.status.status == 'out_for_delivery' %}
                        <i class="bi bi-truck"></i> {# Shipped icon #}
                        {% elif order.status.status == 'delivered' %}
                        <i class="bi bi-cart-check"></i> {# Delivered icon #}
                        {% elif order.status.status == 'cancelled' %}
                        <i class="bi bi-x-circle"></i> {# Cancelled icon #}
                        {% else %}
                        <i class="bi bi-question-circle"></i> {# Default icon for unknown status #}
                        {% endif %}
                    </div>
                    <div class="timeline-line"></div>
                    <div class="timeline-content">
                        <div class="timeline-date">{{ order.status.updated_at|date:"Y-m-d H:i" }}</div>
                        {# Display status timestamp #}
                        <div class="timeline-title">{{ order.status.get_status_display }}</div>
                        {# Display verbose status name #}
                        <div class="timeline-desc">
                            {# Dynamic description based on status - Customize these descriptions #}
                            {% if order.status.status == 'pending' %}
                            Your order has been placed and is awaiting confirmation.
                            {% elif order.status.status == 'accepted' %}
                            Payment confirmed, order is being prepared for shipment.
                            {% elif order.status.status == 'out_for_delivery' %}
                            Order has been shipped and is on its way.
                            {% elif order.status.status == 'delivered' %}
                            Package has been successfully delivered to the customer.
                            {% elif order.status.status == 'cancelled' %}
                            Order has been cancelled.
                            {% else %}
                            Order status updated. Check for details. {# Default description #}
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% else %}
                <p>No status updates yet.</p> {# Message if order.status is None #}
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <p>No orders placed yet.</p>
    {% endfor %}

</div>

<footer id="contact" class="bd-footer py-4 py-md-5 mt-5">
        <div class="footer">

            <div class="container" style="color:white;">
                <div class="row">
                    <div class="col-lg-3 mb-3">
                        <a class="d-inline-flex align-items-center mb-3 text-body-emphasis text-decoration-none"
                           href="" aria-label="RationKart">
                            <img src="{% static 'web/assets/images/Ration.png' %}" width="40" height="32"
                                 class="d-block me-2">
                            <span class="fs-5">RationKart</span>
                        </a>
                        <ul class="list">
                            <li class="mb-2">Designed and built with all the love in the world by the RationKart team
                                with
                                the help of its
                                contributors.
                            </li>

                        </ul>
                    </div>
                    <div class="col-6 col-lg-2 offset-lg-1 mb-4">
                        <h4 style="color:white;" class="mb-4 border-bottom">Important Links</h4>
                        {% if request.session.Reg_Num %}
                        <ul class="mb-4">
                            <li class="mb-2"><a href="{% url 'ShopHome' %}" style="color:white;">Home</a></li>
                            <li class="mb-2"><a style="color:white;" href="{% url 'ShopStock' %}">Products</a></li>
                            <li class="mb-2"><a style="color:white;" href="{% url 'About' %}">About Us</a></li>
                            <li class="mb-2"><a style="color:white;" href="{% url 'ContactUs' %}">Contact Us</a>
                            </li>
                            <li class="mb-2"><a style="color:white;" href="{% url 'CartPage' %}">Cart</a></li>
                            <li class="mb-2"><a style="color:white;" href="{% url 'OrderPage' %}">Your Orders</a>
                            </li>

                        </ul>
                        {% elif request.session.Ration_Card %}
                        <ul class="mb-4">
                            <li class="mb-2"><a href="{% url 'Home' %}" style="color:white;">Home</a></li>
                            <li class="mb-2"><a style="color:white;" href="{% url 'Products' %}">Products</a></li>
                            <li class="mb-2"><a style="color:white;" href="{% url 'About' %}">About Us</a></li>
                            <li class="mb-2"><a style="color:white;" href="{% url 'ContactUs' %}">Contact Us</a>
                            </li>
                            <li class="mb-2"><a style="color:white;" href="{% url 'CartPage' %}">Cart</a></li>
                            <li class="mb-2"><a style="color:white;" href="{% url 'OrderPage' %}">Your Orders</a>
                            </li>

                        </ul>
                        {% elif request.session.delivery_partner %}
                        <ul class="mb-4">
                            <li class="mb-2"><a href="{% url 'Delivery_Partner' %}" style="color:white;">Home</a></li>

                            <li class="mb-2"><a style="color:white;" href="{% url 'About' %}">About Us</a></li>
                            <li class="mb-2"><a style="color:white;" href="{% url 'ContactUs' %}">Contact Us</a>
                        </ul>
                        {% else %}
                        <ul></ul>
                        {% endif %}
                    </div>
                    <div class="col-6 col-lg-2 mb-3">
                        <h4 style="color:white;" class="border-bottom mb-4">For Admins</h4>
                        <ul class="list-unstyled">
                            <li class="mb-2"><a style="color:white;" href="{% url 'AdminLoginPage' %}">Go To Admin
                                DashBoard</a></li>

                        </ul>
                    </div>

                </div>

            </div>

        </div>
        <div class="copyright">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <p style="color:black;">Copyright © 2025 All Right Reserved By RationKart
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script src="{% static 'web/assets/js/jquery.min.js' %}"></script>
    <script src="{% static 'web/assets/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'web/assets/js/jquery-3.0.0.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
{% if messages %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
    {% for message in messages %}
        Swal.fire({
            title: '{{ message.tags|title }}',
            text: '{{ message }}',
            icon: '{{ message.tags }}',
            confirmButtonText: 'OK',
            backdrop: true
        });
    {% endfor %}
     });
</script>
{% endif %}
    <script src="{% static 'web/assets/js/plugin.js' %}"></script>
    <script src="{% static 'web/assets/js/jquery.mCustomScrollbar.concat.min.js' %}"></script>
    <script src="{% static 'web/assets/js/custom.js' %}"></script>
    <script src="{% static 'web/assets/js/owl.carousel.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>